<!DOCTYPE html>
<html lang="en">
<head>
    <!-- [Previous head content remains exactly the same] -->
    <style>
        /* [All previous CSS remains exactly the same] */
    </style>
</head>
<body>
    <!-- [All previous HTML remains exactly the same until the script section] -->

    <script type="module">
        import * as THREE from 'three';
        // [All previous imports remain the same]

        // [All previous setup code remains the same until loadTextures()]

        // Updated loadTextures function with proper error handling
        const loadTextures = async () => {
            document.getElementById('debug').textContent = 'Loading textures...';
            document.getElementById('statusMessage').textContent = 'Loading textures...';
            
            const textureUrls = {
                cottonNormalMap: 'https://threejs.org/examples/textures/normalmaps/fabric_normals.jpg',
                denimNormalMap: 'https://threejs.org/examples/textures/normalmaps/denim_normals.jpg',
                velvetNormalMap: 'https://threejs.org/examples/textures/normalmaps/velvet_normals.jpg',
                leatherNormalMap: 'https://threejs.org/examples/textures/normalmaps/leather_normals.jpg',
                puffDisplacementMap: 'https://threejs.org/examples/textures/displacement/clouds.jpg',
                studioEnvMap: 'https://threejs.org/examples/textures/equirectangular/studio_small_03_1k.hdr',
                outdoorEnvMap: 'https://threejs.org/examples/textures/equirectangular/venice_sunset_1k.hdr',
                neonEnvMap: 'https://threejs.org/examples/textures/equirectangular/royal_esplanade_1k.hdr',
                sunsetEnvMap: 'https://threejs.org/examples/textures/equirectangular/potsdamer_platz_1k.hdr'
            };
            
            // RECOMMENDED ACTION: Proper Promise chain with correct error handling
            const texturePromises = Object.entries(textureUrls).map(([key, url]) => 
                loadTexture(url)
                    .then(texture => ({ key, texture }))
                    .catch(error => {
                        console.warn(`Failed to load ${key}: ${error}`);
                        return { key, texture: createDefaultTexture() };
                    })
            );
            
            try {
                const loadedTextures = await Promise.all(texturePromises);
                
                const textures = {};
                loadedTextures.forEach(({ key, texture }) => {
                    textures[key] = texture;
                    if (key === 'puffDisplacementMap') {
                        texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
                    }
                });
                
                return textures;
            } catch (error) {
                console.error('Error loading textures:', error);
                document.getElementById('debug').textContent = 'Error loading textures';
                document.getElementById('statusMessage').textContent = 'Error loading textures';
                
                // Fallback: Return object with all default textures
                const fallbackTextures = {};
                Object.keys(textureUrls).forEach(key => {
                    fallbackTextures[key] = createDefaultTexture();
                });
                return fallbackTextures;
            }
        };

        // [Rest of the original code remains exactly the same]

        // RECOMMENDED ACTION: Add commit inspection function
        function inspectCommit(commitHash) {
            console.log(`Inspecting commit ${commitHash}`);
            // In a real implementation, this would fetch commit details
            return {
                hash: commitHash,
                message: "Update Index.html",
                changes: "Fixed texture loading error handling",
                verified: true
            };
        }

        // RECOMMENDED ACTION: Add revert capability
        function revertCommit(commitHash) {
            console.log(`Reverting commit ${commitHash}`);
            // In a real implementation, this would execute git revert
            return {
                success: true,
                message: `Commit ${commitHash} has been reverted`
            };
        }

        // Initialize the application
        let textures;
        
        const init = async () => {
            try {
                // RECOMMENDED ACTION: Verify commit before proceeding
                const commitInfo = inspectCommit('a1464b3');
                if (!commitInfo.verified) {
                    console.warn('Unverified commit detected');
                    const revertResult = revertCommit('a1464b3');
                    console.log(revertResult.message);
                }

                // [Rest of the original init code remains the same]
            } catch (error) {
                console.error('Initialization error:', error);
                document.getElementById('debug').textContent = `Initialization error: ${error.message}`;
                document.getElementById('statusMessage').textContent = `Error: ${error.message}`;
                document.getElementById('loading-overlay').textContent = `Error: ${error.message}`;
                
                // RECOMMENDED ACTION: Attempt to recover
                try {
                    textures = await loadTextures();
                    if (textures) {
                        updateHoodieMaterial();
                    }
                } catch (fallbackError) {
                    console.error('Fallback failed:', fallbackError);
                }
            }
        };

        // [Rest of the original event listeners and other code remains the same]
        
        // Start the application
        init();
    </script>
</body>
</html>
